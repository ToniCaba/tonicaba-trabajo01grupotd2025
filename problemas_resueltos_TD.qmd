---
title: "Problemas Resueltos TD"
author: " Claudia Trias de Tena, Reyes de las Aguas García Azancot"
format:
  typst:
    fig-format: png
  html: default
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Problemas Claudia

## Problema 1

Aplica los criterios de decisión bajo incertidumbre e indica cual es la alternativa óptima basándote en la siguiente tabla y teniendo en cuenta todos los posibles criterios de decisión. Considera el problema para ambas situaciones: costes y beneficios.

NOTA: Usar las funciones individuales de incertidumbre por separado.

```{r, echo = FALSE}
library(knitr)
tabla <- data.frame(e1 = c(7, 4,-2),
                    e2 = c(0,3,1),
                    e3 = c(5,8,4))
rownames(tabla) <- c("d1", "d2", "d3")

knitr::kable(tabla)

```

**Solución**

Cargamos las funciones con las que vamos a trabajar:

```{r}
source("teoriadecision_funciones_incertidumbre.R")
```

Creamos la tabla en el formato que necesitan dichas funciones:

```{r}

tb = crea.tablaX(c(7,4,-2,
                  0,3,1,
                  5,8,4),
                  numalternativas = 3,
                  numestados = 3)

```

Consideramos ambos casos y resolvemos el problema:

```{r}

# Caso favorable (Beneficios)

c1 = criterio.Wald(tb, favorable = TRUE)
c2 = criterio.Optimista(tb, favorable = TRUE)
c3 = criterio.Hurwicz(tb, alfa =0.4, favorable = TRUE)
c4 = criterio.Savage(tb, favorable = TRUE)
c5 = criterio.Laplace(tb, favorable = TRUE)
c6 = criterio.PuntoIdeal(tb, favorable = TRUE)

resumen_alt_op = data.frame(Criterio = c("Wald", "Optimista", "Hurwicz", "Savage", "Laplace", "Punto Ideal"),
                            Alternativa_Optima = c(c1$AlternativaOptima, c2$AlternativaOptima, c3$AlternativaOptima, c4$AlternativaOptima, c5$AlternativaOptima, c6$AlternativaOptima))

knitr::kable(resumen_alt_op, caption = "Resumen Alternativas Óptimas - Caso Favorable")

```

Luego, concluimos que la **alternativa óptima** es d3.

Veamos el gráfico del Criterio de Hurwicz para los distintos valores de alpha:

```{r, fig.height = 3}

dibuja.criterio.Hurwicz(tb, favorable = TRUE)

```

Observamos que la alternativa óptima para todo los posibles valores de alpha en el intervalo \[0,1\] es d3. Luego no existe ningún punto de corte entre las rectas asociadas a las distintas alternativas.

```{r}

# Caso desfavorable (Costes)

c1d = criterio.Wald(tb, favorable = FALSE)
c2d = criterio.Optimista(tb, favorable = FALSE)
c3d = criterio.Hurwicz(tb, alfa =0.4, FALSE)
c4d = criterio.Savage(tb, favorable = FALSE)
c5d = criterio.Laplace(tb, favorable = FALSE)
c6d = criterio.PuntoIdeal(tb, favorable = FALSE)

resumen_alt_op = data.frame(Criterio = c("Wald", "Optimista", "Hurwicz", "Savage", "Laplace", "Punto Ideal"),
                            Alternativa_Optima = c(c1d$AlternativaOptima, c2d$AlternativaOptima, c3d$AlternativaOptima, c4d$AlternativaOptima, c5d$AlternativaOptima, c6d$AlternativaOptima))

knitr::kable(resumen_alt_op, caption = "Resumen Alternativas Óptimas - Caso Desfavorable")

```

Luego se concluye que la **alternativa óptima** es d2, salvo bajo el criterio optimista que es d1.

Veamos los gráficos del Criterio de Hurwicz para los distintos valores de alpha:

```{r}
dibuja.criterio.Hurwicz(tb, favorable = FALSE)

```

Observamos que para un valor de alpha en el intervalo (0.6, 0.8), la alternativa óptima pasa de ser la 2 a la 1. Veamos con el siguiente gráfico en que punto ocurre esto.

```{r}

dibuja.criterio.Hurwicz_Intervalos(tb, favorable = FALSE)

```

El punto en el que la alternativa óptima pasa de ser la segunda a la primera es 0.667.

\newpage

## Problema 2

Paula y Claudia quieren hacer algo de deporte el fin de semana. Deciden que el día que mejor les viene es el domingo, pero no se ponen de acuerdo en el deporte que hacer. A ver si usted puede ayudarles. Tienen las siguientes opciones:

-   Hacer escalada en un rocódromo. El equipo de escalada ya lo tienen pero han de pagar por la hora de uso de las instalaciones 20 euros por persona. Planean estar dos horas y la vuelta la harán andando si no llueve y en uber si, por el contrario, llueve. El precio del uber será 15 euros entre las dos.

-   Salir a correr por el parque de al lado de su casa. Si decidiesen esto, deberían comprarse unos zapatos adecuados para ello, que les costarían 45 euros a cada una. La vuelta la harían andando, lloviese o no, pues no se van a alejar mucho de su casa.

-   Montar en bici. Para ello, tendrían que alquilarlas en una tienda cerca de su casa. El precio de alquiler es de 15 euros por hora y por persona. La vuelta la harían en bici si no llueve y en uber si llueve. Teniendo en cuenta que el uber ha de ser especial pues tiene que tener sitio para dos bicicletas, el precio es de 40 euros entre las dos.

¿Qué les recomienda usted que hagan, si su objetivo es minimizar los costes?

**Solución**

Creamos la tabla en el formato que necesitan las funciones:

```{r}

tb2 = crea.tablaX(c(80, 95, 90, 90, 60, 100), numalternativas = 3, numestados = 2,
                  nb_alternativas = c("Escalada","Correr", "Bici"),
                  nb_estados = c("No llueve", "Llueve"))

```

Se trata de un problema de costes, luego la situación es desfavorable. Resolvamos el problema según todos los criterios que conocemos:

```{r}
library(tinytable)
tt(criterio.Todos(tb2, 0.3, favorable = FALSE), rownames = TRUE)

```

Luego la **alternativa óptima** es montar en bici, salvo bajo el criterio de Wald (Criterio pesimista) que es correr.

Añadimos los gráficos del Criterio de Hurwicz

```{r}
dibuja.criterio.Hurwicz(tb2, favorable = FALSE)
```

Observamos que para un valor de alpha en el intervalo (0.2, 0.4), la alternativa óptima pasa de ser la 2 a la 3. Veamos con el siguiente gráfico en que punto ocurre esto.

```{r}
dibuja.criterio.Hurwicz_Intervalos(tb2,favorable = FALSE)

```

El punto en el que la alternativa óptima pasa de ser la segunda a la tercera es 0.25.

\newpage

# Problemas Reyes

```{r, include=FALSE}
source("teoriadecision_funciones_incertidumbre.R")

```

## Problema 1

Aplicar los criterios de decisión bajo incertidumbre a los problemas cuya matriz de valores numéricos vienen dadas en las tablas siguientes:

|        | e1  | e2  |  e3  |
|:------:|:---:|:---:|:----:|
| **d1** | 120 | 60  | -20  |
| **d2** | 80  | 140 |  0   |
| **d3** | 200 | 50  | -100 |

Realizarlo tanto para el caso favorable (beneficios) como para el desfavorable(costos).

### A. Caso favorable

```{r}

tb01a = crea.tablaX(
  c(120, 60, -20,
    80, 140, 0,
    200, 50, -100),
  numalternativas = 3,
  numestados = 3
)

tb01a

# Aplicar los criterios de decisión bajo incertidumbre

# Criterio de Wald (pesimista)
wald <- criterio.Wald(tb01a, favorable = TRUE)
cat("Criterio de Wald (pesimista): la decisión óptima es la",
    wald$AlternativaOptima)


# Criterio Optimista (Maximax)
optimista <- criterio.Optimista(tb01a, favorable = TRUE)
cat("Criterio Optimista (Maximax): la decisión óptima es la",
    optimista$AlternativaOptima)


# Criterio de Hurwicz
hurwicz <- criterio.Hurwicz(tb01a, alfa = 0.4, favorable = TRUE)
cat("Criterio de Hurwicz: la decisión óptima es la",
    hurwicz$AlternativaOptima)


# Criterio de Savage (minimax)
savage <- criterio.Savage(tb01a, favorable = TRUE)
cat("Criterio de Savage (minimax): la decisión óptima es la",
    savage$AlternativaOptima)


# Criterio de Laplace
laplace <- criterio.Laplace(tb01a, favorable = TRUE)
cat("Criterio de Laplace: la decisión óptima es la",
    laplace$AlternativaOptima)


# Criterio del Punto Ideal
puntoideal <- criterio.PuntoIdeal(tb01a, favorable = TRUE)
cat("Criterio del Punto Ideal: la decisión óptima es la",
    puntoideal$AlternativaOptima)


# Dibujos de Hurwicz
dibuja.criterio.Hurwicz(tb01a, TRUE)
gh1_01a=dibuja.criterio.Hurwicz_Intervalos(tb01a, TRUE, TRUE)
gh1_01a

cat("El valor del alpha donde la alternativa óptima pasa de ser la segunda a la tercera es: ",gh1_01a$PuntosDeCorte)
```

```{r}

# Mostrar todos los criterios juntos
sol01a=criterio.Todos(tb01a, 0.4, favorable = TRUE)

library(tinytable)
tt(sol01a, rownames = TRUE)

```

La alternativa **d2** resulta ser la más recomendada, ya que es seleccionada como óptima por la mayoría de los criterios (Wald, Hurwicz y Laplace).

### B. Caso desfavorable

```{r}

tb01b = crea.tablaX(
  c(120, 60, -20,
    80, 140, 0,
    200, 50, -100),
  numalternativas = 3,
  numestados = 3
)

tb01b

# Aplicar los criterios de decisión bajo incertidumbre

# Criterio de Wald (pesimista)
wald <- criterio.Wald(tb01b, favorable = FALSE)
cat("Criterio de Wald (pesimista): la decisión óptima es la",
    wald$AlternativaOptima)

# Criterio Optimista (Minimin)
optimista <- criterio.Optimista(tb01b, favorable = FALSE)
cat("Criterio Optimista (minimin): la decisión óptima es la",
    optimista$AlternativaOptima)

# Criterio de Hurwicz
hurwicz <- criterio.Hurwicz(tb01b, alfa = 0.4, favorable = FALSE)
cat("Criterio de Hurwicz: la decisión óptima es la",
    hurwicz$AlternativaOptima)

# Criterio de Savage (minimax arrepentimiento)
savage <- criterio.Savage(tb01b, favorable = FALSE)
cat("Criterio de Savage (minimax del arrepentimiento): la decisión óptima es la",
    savage$AlternativaOptima)

# Criterio de Laplace (promedio equiprobable)
laplace <- criterio.Laplace(tb01b, favorable = FALSE)
cat("Criterio de Laplace (equiprobable): la decisión óptima es la",
    laplace$AlternativaOptima)

# Criterio del Punto Ideal
puntoideal <- criterio.PuntoIdeal(tb01b, favorable = FALSE)
cat("Criterio del Punto Ideal: la decisión óptima es la",
    puntoideal$AlternativaOptima)


# Dibujos de Hurwicz
dibuja.criterio.Hurwicz(tb01b, FALSE)
gh1_01b=dibuja.criterio.Hurwicz_Intervalos(tb01b, FALSE, TRUE)
gh1_01b

cat("El valor del alfa donde la alternativa óptima pasa de ser la primera a la tercera es: ",gh1_01b$PuntosDeCorte)

```

```{r}
# Mostrar todos los criterios juntos
sol01b = criterio.Todos(tb01b, 0.4, favorable = FALSE)

library(tinytable)
tt(sol01b, rownames = TRUE)

```

La alternativa **d1** es seleccionada como óptima por la mayoría de los criterios (Wald, Hurwicz, Savage y Punto Ideal).

\newpage

## Problema 2.

Laura es una joven emprendedora que desea abrir una cafetería artesanal y se encuentra analizando tres posibles ubicaciones para instalar su negocio: un local en el centro comercial, otro en el barrio universitario, y un tercero en una zona residencial.

Cada local presenta diferentes costes y características:

El local del centro comercial tiene un alquiler mensual de 5.000 euros, pero se encuentra en una zona con gran afluencia de público.

El local del barrio universitario cuesta 2.500 euros mensuales y está en una zona frecuentada por estudiantes y profesores, aunque su actividad disminuye durante el verano.

El local de la zona residencial tiene un alquiler de 1.000 euros al mes, con un flujo de clientes más estable, pero mucho menor.

Además del alquiler, Laura estima que deberá asumir otros costes anuales fijos, que incluyen:

Proveedores (materias primas como café, leche, repostería, etc.), con un gasto de 90.000 euros anuales en el centro comercial, 60.000 euros en el barrio universitario y 35.000 euros en la zona residencial.

Coste de personal, que será de 54.000 € anuales en el centro comercial (mayor plantilla), 36.000 € en el barrio universitario y 24.000 € en la zona residencial.

Otros gastos de mantenimiento, publicidad y electricidad, calculados en 12.000 euros para el centro comercial, 8.000 euros para el barrio universitario y 6.000 euros para la zona residencial.

Laura cree que los ingresos anuales dependerán del estado de la economía durante el primer año de funcionamiento:

Si la economía es favorable, calcula que podría ingresar 220.000 € en el centro comercial, 160.000 € en el barrio universitario, 130.000 € en la zona residencial.

Si la situación se mantiene estable, sus ingresos serían de unos 150.000 €en el centro comercia, 110.000 € en el barrio universitario y 100.000 € en la zona residencial.

Y si hay una recesión, las ventas podrían caer hasta 100.000 € en el centro comercial, 70.000 € en el barrio universitario, 75.000 € en la zona residencial.

Su objetivo es determinar cuál de los tres locales le conviene más .

**Solución**

Modelo de beneficios (favorable).

Alternativas:

d1: Centro comercial

d2: Barrio universitario

d3: Zona residencial

Estados de la naturaleza:

e1: Economía favorable

e2: Economía estable

e3: Recesión

```{r}

#Para e1:

#Centro Comercial
m11 = 220000-5000*12-90000-54000-12000

#Barrio Universitario
m12 = 160000-2500*12-60000-36000-8000

#Zona Residencial
m13 = 130000-1000*12-35000-24000-6000


#Para e2:
#Centro Comercial
m21 = 150000-5000*12-90000-54000-12000

#Barrio Universitario
m22 = 110000-2500*12-60000-36000-8000

#Zona Residencial
m23 = 100000-1000*12-35000-24000-6000


#Para e3:
#Centro Comercial
m31 = 100000-5000*12-90000-54000-12000

#Barrio Universitario
m32 = 70000-2500*12-60000-36000-8000

#Zona Residencial
m33 = 75000-1000*12-35000-24000-6000

tb02<-crea.tablaX(
  c(m11, m21, m31,  # Centro comercial
    m12, m22, m32,  # Barrio universitario
    m13, m23, m33), # Zona residencial 
  numalternativas = 3,
  numestados = 3, 
  nb_estados= c("Favorable", "Estable", "Recesión"), 
  nb_alternativas=c("CentroComercial", "BarrioUniversitario", "ZonaResidencial") )

tb02

sol02 = criterio.Todos(tb02, 0.5, favorable = TRUE)
library(tinytable)
tt(sol02, rownames = TRUE)



```

Según los distintos criterios de incertidumbre, Laura debería instalar su cafetería en el **zona residencial**.

```{r}
# Dibujos de Hurwicz
dibuja.criterio.Hurwicz(tb02, TRUE)
```

Observando el gráfico, podemos apreciar que la alternativa de instalar la cafetería en el zona residencial es la óptima para cualquier valor de alpha entre 0 y 1.


# Problemas Antonio

## Problema 1

Una empresa que fabrica cápsulas de café debe decidir entre tres posibles proveedores: **Aroma S.A.**, **Cafés del Sur** y **Tostadores Sevilla**.\
El precio por kilo dependerá de la **cosecha anual**, que puede ser *buena*, *normal* o *mala*.

**Pregunta:**\
Si la empresa no conoce las probabilidades de cada tipo de cosecha, ¿qué proveedor debería elegir para minimizar el riesgo de pagar precios altos?

```{r}
# Tabla de precios
proveedores <- matrix(
  c(8, 9, 13,
    9, 8, 11,
    7, 10, 15),
  nrow = 3, byrow = TRUE
)
colnames(proveedores) <- c("Cosecha buena", "Cosecha normal", "Cosecha mala")
rownames(proveedores) <- c("Aroma S.A.", "Cafés del Sur", "Tostadores Sevilla")

# Mostrar tabla de precios
print("Tabla de precios por proveedor (€/kg):")
print(proveedores)

# Criterio de Laplace (promedio de costes)
media_costes <- rowMeans(proveedores)
knitr::kable(data.frame(Proveedor=rownames(proveedores), Coste_Medio=media_costes),
             caption = "Coste medio según Laplace")

# Decisión recomendada
mejor_proveedor <- names(which.min(media_costes))
mejor_proveedor

```

## Problema 2

Una pequeña cadena de supermercados de Sevilla debe elegir entre tres proveedores de energía:

- **SolarSur** (solar)  
- **EólicaAndalucía** (eólica)  
- **HidroPower** (hidroeléctrica)

El beneficio anual estimado (en miles de euros) depende del precio de la energía durante el año: **bajo (e1)**, **medio (e2)**, **alto (e3)**.

```{r}
# Tabla de beneficios
energia <- matrix(
  c(60, 80, 100,
    50, 100, 120,
    70, 90, 110),
  nrow = 3,
  byrow = TRUE
)
colnames(energia) <- c("Bajo", "Medio", "Alto")
rownames(energia) <- c("SolarSur", "EólicaAndalucía", "HidroPower")

# Mostrar tabla
knitr::kable(energia, caption = "Tabla de beneficios por proveedor (miles de euros)")

# Función para calcular todos los criterios de decisión
decision_incertidumbre <- function(tabla, alpha = 0.6) {
  # Maximax
  maximax <- apply(tabla, 1, max)
  
  # Maximin
  maximin <- apply(tabla, 1, min)
  
  # Laplace
  laplace <- rowMeans(tabla)
  
  # Hurwicz
  hurwicz <- alpha * apply(tabla, 1, max) + (1 - alpha) * apply(tabla, 1, min)
  
  # Savage
  mejores <- apply(tabla, 2, max)
  regret <- sweep(mejores, 2, tabla, "-")
  savage <- apply(regret, 1, max)
  
  # Tabla de resultados
  data.frame(
    Decisión = rownames(tabla),
    Maximax = maximax,
    Maximin = maximin,
    Laplace = laplace,
    Hurwicz = hurwicz,
    Savage = savage
  )
}

# Aplicar la función
resultado <- decision_incertidumbre(energia)

# Mostrar tabla de resultados
knitr::kable(resultado, caption = "Resultados de todos los criterios")

# Conclusión
print("**Conclusión:** La opción más recomendable según la mayoría de criterios es EólicaAndalucía.")

